<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"      
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">

  <f:view contentType="text/html">

    <p:confirmDialog id="confirmDialog" 
                     message="DELETE cannot be undone"  
                     header="Confirm DELETE" 
                     severity="alert" 
                     widgetVar="confirmation">  

      <p:commandButton id="confirm" 
                       value="Yes, DELETE"
                       style="background-color: red;"
                       oncomplete="confirmation.hide()" 
                       actionListener="#{listManagerController.performDeleteList}"                               
                       update=":myform:outerTabView:listManagerTabView"/>      

      <p:commandButton id="decline" 
                       value="NO" 
                       onclick="confirmation.hide()" 
                       type="button" />   

    </p:confirmDialog>  

    <p:tabView id="listManagerTabView" dynamic="true">

      <p:tab title="Available Lists">

        <p:outputPanel id="availableListsPanel">

          <h:outputText value="#{listManagerController.loggedUser}"></h:outputText>

          <p:commandButton value="Invalidate Session"                           
                           actionListener="#{listManagerController.logout}"/>

          <p:commandButton value="Update Lists"
                           action="#{listManagerController.performUpdateAvailableLists()}"
                           update=":myform:outerTabView:listManagerTabView"/>

          <p:spacer height="10"/>

          <p:dataTable  resizableColumns="true"
                        id="availableListsTbl"
                        var="list"
                        value="#{listManagerController.availableLists}"
                        paginator="true" 
                        rows="10"  
                        paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                        rowsPerPageTemplate="10,25,50"
                        rowKey="#{list.cmpdListId}"
                        selection="#{listManagerController.selectedLists}" 
                        selectionMode="multiple">  

            <f:facet name="header">  
              Available Lists With #{fn:length(listManagerController.availableLists)} Lists
            </f:facet>

            <!--
<p:column>
<p:commandButton value="HISTOGRAM"
                 icon="ui-icon-image"
                 action="#{listManagerController.renderListHistograms()}"
                 update=":myform:HistogramsDialog"
                 oncomplete="histogramsdlg.show();">      
  <f:setPropertyActionListener value="#{list}"   
                               target="#{listManagerController.selectedList}"/>  
</p:commandButton>              
</p:column>
            -->

            <p:column>

              <p:commandButton value="VIEW"
                               icon="ui-icon-image"
                               action="#{listManagerController.performLoadSelectedList()}"
                               update=":myform:growl,:myform:ListContentDialog,:myform:outerTabView:activeListTabView"
                               onstart="bui_loadlist_block.show();"
                               oncomplete="bui_loadlist_block.hide();listcontentdlg.show();">      

                <f:setPropertyActionListener value="#{list}"   
                                             target="#{listManagerController.selectedList}"/>  

              </p:commandButton>

            </p:column>

            <p:column>

              <p:commandButton disabled="#{list.listOwner!='kunkelm'}"                
                               value="DELETE" 
                               style="background-color: red;"
                               onclick="setListForDelete#{list.cmpdListId}();confirmation.show()"                                
                               type="button"/> 

              <p:remoteCommand name="setListForDelete#{list.cmpdListId}">    
                <f:setPropertyActionListener value="#{list}"   
                                             target="#{listManagerController.selectedList}"/>  
              </p:remoteCommand>  

            </p:column>

            <p:column>

              <p:commandButton  disabled="#{list.listOwner!='kunkelm'}"
                                value="SHARE"
                                style="background-color: green;"
                                action="#{listManagerController.performMakeListPublic()}"                               
                                update=":myform:outerTabView:listManagerTabView">      

                <f:setPropertyActionListener value="#{list}"   
                                             target="#{listManagerController.selectedList}"/>  

              </p:commandButton>

            </p:column>

            <p:column sortBy="#{list.cmpdListId}">
              <f:facet name="header">  
                <h:outputText value="CmpdListId" />  
              </f:facet>  
              <h:outputText value="#{list.cmpdListId}" />  
            </p:column> 

            <p:column sortBy="#{list.dateCreated}">
              <f:facet name="header">  
                <h:outputText value="Date Created" />  
              </f:facet>  
              <h:outputText value="#{list.dateCreated}" />  
            </p:column> 

            <p:column sortBy="#{list.listName}">
              <f:facet name="header">  
                <h:outputText value="List Name" />  
              </f:facet>  
              <h:outputText value="#{list.listName}" />  
            </p:column> 

            <p:column sortBy="#{list.countListMembers}">
              <f:facet name="header">  
                <h:outputText value="List Size" />  
              </f:facet>  
              <h:outputText value="#{list.countListMembers}" />  
            </p:column> 

            <p:column sortBy="#{list.listOwner}">
              <f:facet name="header">  
                <h:outputText value="Owner" />  
              </f:facet>  
              <h:outputText value="#{list.listOwner}" />  
            </p:column> 

            <p:column sortBy="#{list.shareWith}">
              <f:facet name="header">  
                <h:outputText value="Share With" />  
              </f:facet>  
              <h:outputText value="#{list.shareWith}" />  
            </p:column> 

          </p:dataTable>

        </p:outputPanel>

        <p:blockUI block=":myform:outerTabView:listManagerTabView" 
                   widgetVar="bui_loadlist_block">
          LOADING LIST
          <p:graphicImage name="images/ajax-loader.gif"/>  
        </p:blockUI>

      </p:tab>

      <p:tab title="Create List by Search of DTP Compounds">

        <p:panel>

          <f:facet name="header">  
            Create list by combination of NSC numbers and/or Project Codes
          </f:facet>

          <p:panelGrid columns="2">

            <h:outputLabel for="listnametext" value="List Name"/>
            <h:inputText value="#{listManagerController.listName}" id="listnametext" cols="15" rows="5"/>

            <h:outputLabel for="nsctextarea" value="NSCs"/>
            <h:inputTextarea  value="#{listManagerController.nscTextArea}" id="nsctextarea" cols="15" rows="5"/>

            <h:outputLabel for="projectcodetextarea" value="Project Codes"/>
            <h:inputTextarea  value="#{listManagerController.projectCodeTextArea}" id="projectcodetextarea" cols="15" rows="5"/>

          </p:panelGrid>

          <p:commandButton value="Create List"
                           id="createListButton"
                           action="#{listManagerController.performCreateListBySearch()}"
                           update=":myform:ListContentDialog,:myform:outerTabView:listManagerTabView"
                           onstart="bui_createlist_block.show();"
                           oncomplete="bui_createlist_block.hide();listcontentdlg.show();"/>
        </p:panel>

        <p:blockUI block=":myform:outerTabView:listManagerTabView" 
                   widgetVar="bui_createlist_block">
          CREATING LIST<br />  
          <p:graphicImage name="images/ajax-loader.gif"/>  
        </p:blockUI>


      </p:tab>

      <p:tab title="Create List from Uploaded File">
        <p:panel>

          <f:facet name="header">
            <h:outputText value="Create a list with structures from SDF or MOL files (.sdf or .mol extension)"/>
          </f:facet>

          <p:fileUpload
            style="width: 700px;"
            mode="advanced" 
            allowTypes="/(\.|\/)(sdf|mol)$/"
            fileUploadListener="#{listManagerController.handleFileUpload}"                          
            update=":myform:growl,:myform:ListContentDialog,:myform:ListOfCmpdsDialog,:myform:outerTabView:listManagerTabView"
            onstart="bui_upload_block.show();"
            oncomplete="bui_upload_block.hide();listofcmpdsdlg.show();listcontentdlg.show();">

          </p:fileUpload>

        </p:panel>

        <p:blockUI block=":myform:outerTabView:listManagerTabView" 
                   widgetVar="bui_upload_block">
          UPLOADING AND PROCESSING<br />  
          <p:graphicImage name="images/ajax-loader.gif"/>  
        </p:blockUI>


      </p:tab>

      <p:tab title="Logical Operations on Lists">

        <p:outputPanel id="listLogicPanel">

          <p:panelGrid columns="2">

            <h:outputText value="List A" />          
            <p:selectOneMenu value="#{listManagerController.listAid}">  
              <f:selectItem itemLabel="Select One" itemValue="" />  
              <f:selectItems value="#{listManagerController.availableListSelectItems}" />  
            </p:selectOneMenu>  

            <h:outputText value="List B" />                  
            <p:selectOneMenu value="#{listManagerController.listBid}">  
              <f:selectItem itemLabel="Select One" itemValue="" />  
              <f:selectItems value="#{listManagerController.availableListSelectItems}" />  
            </p:selectOneMenu>  

          </p:panelGrid>

          <p:spacer height="10"/>

          <p:commandButton value="DO LOGIC"
                           action="#{listManagerController.performListLogic()}"                               
                           onstart="bui_listlogic_block.show();"
                           update=":myform:outerTabView:listManagerTabView:listLogicPanel"
                           oncomplete="bui_listlogic_block.hide();"/>      

          <p:spacer height="10"/>

          <p:panelGrid columns="4">

            <h:outputText value="List A OR List B"/>
            <h:outputText value="#{fn:length(listManagerController.cmpdsListAorListB)}"/>

            <p:commandButton value="VIEW"
                             icon="ui-icon-image"
                             update=":myform:growl,:myform:ListOfCmpdsDialog"
                             oncomplete="listofcmpdsdlg.show()">      

              <f:setPropertyActionListener value="#{listManagerController.cmpdsListAorListB}"   
                                           target="#{listManagerController.listOfCmpds}"/>  

            </p:commandButton>

            <h:outputText value="SAVE button goes here"/>

            <h:outputText value="List A AND List B"/>
            <h:outputText value="#{fn:length(listManagerController.cmpdsListAandListB)}"/>

            <p:commandButton value="VIEW"
                             icon="ui-icon-image"
                             update=":myform:growl,:myform:ListOfCmpdsDialog"
                             oncomplete="listofcmpdsdlg.show()">      

              <f:setPropertyActionListener value="#{listManagerController.cmpdsListAandListB}"   
                                           target="#{listManagerController.listOfCmpds}"/>  

            </p:commandButton>

            <h:outputText value="SAVE button goes here"/>

            <h:outputText value="List A NOT List B"/>
            <h:outputText value="#{fn:length(listManagerController.cmpdsListAnotListB)}"/>

            <p:commandButton value="VIEW"
                             icon="ui-icon-image"
                             update=":myform:growl,:myform:ListOfCmpdsDialog"
                             oncomplete="listofcmpdsdlg.show()">      

              <f:setPropertyActionListener value="#{listManagerController.cmpdsListAnotListB}"   
                                           target="#{listManagerController.listOfCmpds}"/>  

            </p:commandButton>

            <p:commandButton value="SAVE THIS LIST"
                             icon="ui-icon-image"
                             action="#{listManagerController.performSaveListLogicCmpds()}"
                             update=":myform:growl,:myform:ListOfCmpdsDialog"
                             oncomplete="listofcmpdsdlg.show()">      

              <f:setPropertyActionListener value="#{listManagerController.cmpdsListAnotListB}"   
                                           target="#{listManagerController.listOfCmpds}"/>  

            </p:commandButton>


            <h:outputText value="SAVE button goes here"/>

          </p:panelGrid>



        </p:outputPanel>

      </p:tab>

    </p:tabView>

    <p:blockUI block=":myform:outerTabView:listManagerTabView" 
               widgetVar="bui_listlogic_block">
      RESOLVING LISTS
      <p:graphicImage name="images/ajax-loader.gif"/>  
    </p:blockUI>

  </f:view>

</ui:composition>