<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"      
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                template="/webpages/templates/ui.xhtml">

  <ui:define name="content">

    <ui:remove><ui:include src="/webpages/templates/active_list_nav.xhtml"/></ui:remove>

    <p:fieldset legend="Export All Data">  

      <p:commandButton ajax="false" value="Export to Excel">
        <p:dataExporter type="xls" 
                        target="activeListTbl" 
                        fileName="activeList_listId_#{listManagerController.activeList.cmpdListId}" />        
      </p:commandButton>

      <p:spacer width="20"/>

      <p:commandButton ajax="false" value="Export as CSV">  
        <p:dataExporter type="csv" 
                        target="activeListTbl" 
                        fileName="activeList_listId_#{listManagerController.activeList.cmpdListId}" />
      </p:commandButton> 

      <p:spacer width="20"/>

      <p:commandButton ajax="false" value="Export to Excel with Structure Images">
        <p:dataExporter type="xls" 
                        target="activeListTbl" 
                        postProcessor="#{listManagerController.postProcessXLS}"
                        fileName="activeList_listId_#{listManagerController.activeList.cmpdListId}" />        
      </p:commandButton>

      <p:spacer width="20"/>

      <p:commandButton onclick="structuresAsGridImage();" 
                       value="Image of bare structures as grid" /> 

    </p:fieldset>

    <p:spacer height="20" width="100%"/>

    <p:panel rendered="${!empty listManagerController.activeList.anchorSmiles}">

      <h:outputText value="anchorSmiles: ${listManagerController.activeList.anchorSmiles}"/>

      <br/>

      <h:graphicImage alt="activeListAnchorSmiles"
                      width="200" height="200"
                      url='/StructureServlet?structureDim=200&amp;title=listAnchorSmiles&amp;smiles=#{applicationScopeBean.urlEncode(listManagerController.activeList.anchorSmiles)}'>              
      </h:graphicImage>

    </p:panel>

    <p:spacer height="20" width="100%"/>

    <p:dataTable  id="activeListTbl"
                  var="listMember" 
                  value="#{listManagerController.activeList.cmpdListMembers}" 
                  rows="50"                        
                  paginator="true"
                  resizableColumns="false"
                  paginatorTemplate="On Page {CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} Rows Per Page"  
                  rowsPerPageTemplate="50,100,250,500"
                  selection="#{listContentController.selectedActiveListMembers}"
                  rowKey="#{listMember.id}"                              
                  sortMode="multiple">  

      <p:ajax event="rowSelect" listener="#{listContentController.onRowSelect}" />
      <p:ajax event="rowUnselect" listener="#{listContentController.onRowDeSelect}" />

      <f:facet name="header">                
        <h:outputText value="List #{listManagerController.activeList.listName} with #{fn:length(listManagerController.activeList.cmpdListMembers)} Members"/>    
      </f:facet>

      <p:column headerText="All"
                resizable="true" selectionMode="multiple" 
                style="width:4%" 
                exportable="false"/>

      <p:column headerText="Click for details" resizable="true">

        <p:commandLink update=":datasystemForm:ListMemberDetailsDialogPanel" oncomplete="PF('listMemberDetailDlg').show();" title="View Detail">
          <h:graphicImage alt="png-structure-with-highlighted-substructure-image"
                          width="75" height="75"
                          url='/StructureServlet?structureDim=75&amp;title=#{listMember.cmpd.name}&amp;smiles=#{applicationScopeBean.urlEncode(listMember.cmpd.parentFragment.cmpdFragmentStructure.canSmi)}&amp;querySmiles=#{applicationScopeBean.urlEncode(listManagerController.activeList.anchorSmiles)}'>              
          </h:graphicImage>
          <f:setPropertyActionListener value="#{listMember}"   
                                       target="#{listManagerController.selectedActiveListMember}" />  
        </p:commandLink>

        <h:graphicImage style="display: none;" alt="png-structure-with-highlighted-substructure-image"
                        width="200" height="200"
                        id="structureImg"
                        url='/StructureServlet?structureDim=200&amp;title=#{listMember.cmpd.name}&amp;smiles=#{applicationScopeBean.urlEncode(listMember.cmpd.parentFragment.cmpdFragmentStructure.canSmi)}&amp;querySmiles=#{applicationScopeBean.urlEncode(listManagerController.activeList.anchorSmiles)}'>              
        </h:graphicImage>

      </p:column>

      <ui:remove>

        <p:column headerText="adHocCmpdId" resizable="true" sortBy="#{listMember.cmpd.adHocCmpdId}">                                
          <h:outputText value="#{listMember.cmpd.adHocCmpdId}"/>
        </p:column>  

        <p:column headerText="originalAdHocCmpdId" resizable="true" sortBy="#{listMember.cmpd.originalAdHocCmpdId}">                                
          <h:outputText value="#{listMember.cmpd.originalAdHocCmpdId}"/>
        </p:column>  

        <p:column headerText="nscCmpdId" resizable="true" sortBy="#{listMember.cmpd.nscCmpdId}">                                
          <h:outputText value="#{listMember.cmpd.nscCmpdId}"/>
        </p:column>  

      </ui:remove>

      <p:column headerText="Comment" resizable="true">                                
        <h:outputText value="#{listMember.listMemberComment}"/>
      </p:column>             

      <p:column headerText="NSC Cmpd Type" resizable="true"
                filterBy="#{listMember.cmpd.nscCmpdType}"
                filterMatchMode="contains">                                
        <h:outputText value="#{listMember.cmpd.nscCmpdType}"/>
      </p:column>             

      <p:column headerText="Count Fragments" 
                resizable="true" 
                sortBy="#{listMember.cmpd.countCmpdFragments}">                                
        <h:outputText value="#{listMember.cmpd.countCmpdFragments}"/>
      </p:column>    

      <p:column headerText="NSC" resizable="true" sortBy="#{listMember.cmpd.nsc}">                                
        <h:outputText value="#{listMember.cmpd.nsc}"/>
      </p:column>             

      <p:column headerText="Name" 
                resizable="true" 
                sortBy="#{listMember.cmpd.name}" 
                filterBy="#{listMember.cmpd.name}"
                filterMatchMode="contains">                
        <h:outputText value="#{listMember.cmpd.name}"/>                
      </p:column>       


      <p:column headerText="Inventory" resizable="true" sortBy="#{listMember.cmpd.inventory}">                                
        <h:outputText value="#{listMember.cmpd.inventory}"/>
      </p:column>

      <p:column headerText="NCI60" resizable="true" sortBy="#{listMember.cmpd.cmpdBioAssay.nci60}">                
        <f:facet name="header">                
          <h:outputText value="NCI60"/>                
        </f:facet>              
        <h:outputText value="#{listMember.cmpd.cmpdBioAssay.nci60}"/>
      </p:column>

      <p:column headerText="HF" resizable="true" sortBy="#{listMember.cmpd.cmpdBioAssay.hf}">                
        <h:outputText value="#{listMember.cmpd.cmpdBioAssay.hf}"/>
      </p:column>

      <p:column headerText="XENO" resizable="true" sortBy="#{listMember.cmpd.cmpdBioAssay.xeno}">                
        <h:outputText value="#{listMember.cmpd.cmpdBioAssay.xeno}"/>
      </p:column>

      <p:column headerText="Aliases" resizable="true">                
        <p:scrollPanel style="width:250px;height:100px"> 
          <p:dataList value="#{listMember.cmpd.aliases}" var="n" itemType="disc" type="ordered">  
            <h:outputText value="#{n}"/>                
          </p:dataList>
        </p:scrollPanel>
      </p:column>   

      <p:column headerText="Projects" resizable="true">                
        <p:scrollPanel style="width:250px;height:100px"> 
          <p:dataList value="#{listMember.cmpd.projects}" var="n" itemType="disc" type="ordered">  
            <h:outputText value="#{n}"/>                
          </p:dataList>
        </p:scrollPanel>
      </p:column>   

      <p:column headerText="Plates" resizable="true">                
        <p:scrollPanel style="width:250px;height:100px"> 
          <p:dataList value="#{listMember.cmpd.plates}" var="n" itemType="disc" type="ordered">  
            <h:outputText value="#{n}"/>                
          </p:dataList>
        </p:scrollPanel>
      </p:column>   

      <p:column headerText="molecularWeight" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.molecularWeight}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.molecularWeight}">
          <f:convertNumber pattern="#0.00" />
        </h:outputText>
      </p:column>

      <p:column headerText="molecularFormula" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.molecularFormula}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.molecularFormula}" />
      </p:column>

      <p:column headerText="logD" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.logD}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.logD}">
          <f:convertNumber pattern="#0.00" />
        </h:outputText>
      </p:column>

      <p:column headerText="countHydBondAcceptors" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countHydBondAcceptors}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countHydBondAcceptors}" />
      </p:column>

      <p:column headerText="countHydBondDonors" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countHydBondDonors}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countHydBondDonors}" />
      </p:column>

      <p:column headerText="surfaceArea" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.surfaceArea}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.surfaceArea}">
          <f:convertNumber pattern="#0.00" />
        </h:outputText>
      </p:column>

      <p:column headerText="solubility" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.solubility}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.solubility}">
          <f:convertNumber pattern="#0.00" />
        </h:outputText>
      </p:column>

      <p:column headerText="countRings" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countRings}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countRings}" />
      </p:column>

      <p:column headerText="countAtoms" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countAtoms}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countAtoms}" />
      </p:column>

      <p:column headerText="countBonds" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countBonds}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countBonds}" />
      </p:column>

      <p:column headerText="countSingleBonds" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countSingleBonds}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countSingleBonds}" />
      </p:column>

      <p:column headerText="countDoubleBonds" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countDoubleBonds}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countDoubleBonds}" />
      </p:column>

      <p:column headerText="countTripleBonds" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countTripleBonds}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countTripleBonds}" />
      </p:column>

      <p:column headerText="countRotatableBonds" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countRotatableBonds}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countRotatableBonds}" />
      </p:column>

      <p:column headerText="countHydrogenAtoms" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countHydrogenAtoms}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countHydrogenAtoms}" />
      </p:column>

      <p:column headerText="countMetalAtoms" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countMetalAtoms}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countMetalAtoms}" />
      </p:column>

      <p:column headerText="countHeavyAtoms" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countHeavyAtoms}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countHeavyAtoms}" />
      </p:column>

      <p:column headerText="countPositiveAtoms" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countPositiveAtoms}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countPositiveAtoms}" />
      </p:column>

      <p:column headerText="countNegativeAtoms" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countNegativeAtoms}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countNegativeAtoms}" />
      </p:column>

      <p:column headerText="countRingBonds" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countRingBonds}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countRingBonds}" />
      </p:column>

      <p:column headerText="countStereoAtoms" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countStereoAtoms}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countStereoAtoms}" />
      </p:column>

      <p:column headerText="countStereoBonds" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countStereoBonds}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countStereoBonds}" />
      </p:column>

      <p:column headerText="countRingAssemblies" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countRingAssemblies}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countRingAssemblies}" />
      </p:column>

      <p:column headerText="countAromaticBonds" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countAromaticBonds}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countAromaticBonds}" />
      </p:column>

      <p:column headerText="countAromaticRings" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countAromaticRings}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.countAromaticRings}" />
      </p:column>

      <p:column headerText="formalCharge" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.formalCharge}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.formalCharge}" />
      </p:column>

      <p:column headerText="theALogP" resizable="true" sortBy="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.theALogP}">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem.theALogP}">
          <f:convertNumber pattern="#0.00" />
        </h:outputText>
      </p:column>

      <p:column headerText="SMILES" resizable="true">                
        <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentStructure.canSmi}">
        </h:outputText>
      </p:column>

    </p:dataTable>

  </ui:define>

</ui:composition>
