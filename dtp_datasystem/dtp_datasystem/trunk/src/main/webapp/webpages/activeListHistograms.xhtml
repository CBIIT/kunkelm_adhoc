<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:p="http://primefaces.org/ui">

    <f:view contentType="text/html">

        <h:head>
            <f:facet name="first">
                <meta http-equiv="X-UA-Compatible" content="EmulateIE8" />
                <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
                <title>Data System Project Histograms and ScatterPlots</title>
            </f:facet>

            <noscript>
                <font color="red" size="5">This website makes use of javascript.  Please enable javascript in your web browser and reload this web page.</font>
            </noscript>

            <h:outputScript library="js" name="dctdDataSystem.js"/>                
            <h:outputScript library="js" name="canvasWrangling.js"/>
            <h:outputStylesheet library="css" name="my.css"/>

        </h:head>

        <h:body>

            <p:blockUI block=":histogramsForm:HistogramsPanel" 
                       widgetVar="histoBUI">
                <h:outputText style="color: green; font-size: 40px" value="HISTOGRAMS" />  
                <p:graphicImage name="images/ajax-loader.gif"/>  
            </p:blockUI>

            <p:blockUI block=":scatterPlotsForm:ScatterPlotsPanel" 
                       widgetVar="spBUI">
                <h:outputText style="color: green; font-size: 40px" value="SCATTER PLOTS" />  
                <p:graphicImage name="images/ajax-loader.gif"/>  
            </p:blockUI>

            <p:blockUI block=":structuresForm:StructuresPanel" 
                       widgetVar="strcBUI">
                <h:outputText style="color: green; font-size: 40px" value="STRUCTURES" />  
                <p:graphicImage name="images/ajax-loader.gif"/>  
            </p:blockUI>

            <p:growl id="msgs" 
                     showDetail="true" 
                     autoUpdate="true"
                     sticky="true" />

            <p:layout  fullPage="true">

                <p:layoutUnit position="north"  
                              resizable="true"
                              size="15%">	

                    <h:form id="histogramsConfigurationForm" enctype="multipart/form-data">

                        <h:outputText style="font-size: 200%;" 
                                      value="ActiveList is: #{listManagerController.listManagerBean.activeList.listName} with #{fn:length(listManagerController.listManagerBean.activeList.cmpdListMembers)} ListMembers"/>    

                        <p:outputPanel id="HistogramsConfiguration">

                            <h:outputText style="font-size: 200%;" value="List #{listManagerController.listManagerBean.activeList.listName} with #{fn:length(histogramController.cmpdListMembers)} Members"/>

                            <br/>

                            <p:selectManyButton value="#{histogramController.parametersPchem}" >  
                                <f:selectItem itemLabel="mw" itemValue="mw" />  
                                <f:selectItem itemLabel="hba" itemValue="hba" />  
                                <f:selectItem itemLabel="hbd" itemValue="hbd" />  
                                <f:selectItem itemLabel="alogp" itemValue="alogp" />  
                                <f:selectItem itemLabel="logd" itemValue="logd" />  
                                <f:selectItem itemLabel="sa" itemValue="sa" />  
                                <f:selectItem itemLabel="psa" itemValue="psa" />  
                            </p:selectManyButton>

                            <p:commandButton ajax="true" 
                                             disabled="#{empty histogramController.cmpdListMembers}"
                                             value="UPDATE"
                                             icon="ui-icon-image"
                                             action="#{histogramController.renderHistoAndScatter()}"
                                             onstart="PF('histoBUI').show();PF('spBUI').show();PF('strcBUI').show();"
                                             oncomplete="PF('histoBUI').hide();PF('spBUI').hide();PF('strcBUI').hide();"
                                             update=":histogramsForm:HistogramsPanel,:scatterPlotsForm:ScatterPlotsPanel,:structuresForm:StructuresPanel" />   

                            <p:commandButton ajax="true" 
                                             disabled="#{empty histogramController.cmpdListMembers}"
                                             value="CLEAR SELECTIONS"
                                             icon="ui-icon-image"
                                             action="#{histogramController.performClearSelections()}"
                                             update=":histogramsForm:HistogramsPanel,:scatterPlotsForm:ScatterPlotsPanel,:structuresForm:StructuresPanel" />   

                        </p:outputPanel>

                    </h:form>

                </p:layoutUnit>

                <p:layoutUnit position="west" 
                              resizable="true" 
                              size="50%" 
                              minSize="100">	

                    <h:form id="histogramsForm" enctype="multipart/form-data">

                        <p:outputPanel id="HistogramsPanel">

                            <p:commandButton disabled="false"                                 
                                             type="button"
                                             value="All Histograms as Image" 
                                             onclick="addAllCharts('widgetHistogramChart', null)"/>                

                            <p:selectOneRadio value="#{histogramController.histogramSizeString}">
                                <f:selectItem itemLabel="small" itemValue="small" />  
                                <f:selectItem itemLabel="medium" itemValue="medium" />  
                                <f:selectItem itemLabel="large" itemValue="large" />  

                                <p:ajax event="change" 
                                        update=":histogramsForm:HistogramsPanel"
                                        process="@this" />

                            </p:selectOneRadio>

                            <h:outputText rendered="#{histogramController.histogramList == null}"
                                          value="NO HISTOGRAMS"
                                          style="font-size: 200%;" />

                            <ui:repeat rendered="#{histogramController.histogramList != null}"
                                       value="#{histogramController.histogramList}" 
                                       var="histo"
                                       varStatus="histoIdx">    


                                <p:chart type="bar" 
                                         model="#{histo.chartModel}" 
                                         style="display: inline-block; height: #{histogramController.histogramSize}px; width: #{histogramController.histogramSize}px"
                                         widgetVar="widgetHistogramChart#{histoIdx.index}">

                                    <p:ajax event="itemSelect" 
                                            immediate="true" 
                                            process="@this"
                                            listener="#{histogramController.itemSelectHistogram}"
                                            update=":histogramsForm:HistogramsPanel,:scatterPlotsForm:ScatterPlotsPanel,:structuresForm:StructuresPanel"/>   

                                </p:chart>

                            </ui:repeat>

                        </p:outputPanel>

                    </h:form>

                </p:layoutUnit>

                <p:layoutUnit position="center"
                              resizable="true">	

                    <h:form id="scatterPlotsForm" enctype="multipart/form-data">

                        <p:outputPanel id="ScatterPlotsPanel">

                            <p:commandButton disabled="false"                                 
                                             type="button"
                                             value="All Scatter Plots as Image" 
                                             onclick="addAllCharts('widgetScatterPlotChart', '#{fn:length(histogramController.parametersPchem)}')"/>                

                            <p:selectOneRadio value="#{histogramController.scatterPlotSizeString}">
                                <f:selectItem itemLabel="small" itemValue="small" />  
                                <f:selectItem itemLabel="medium" itemValue="medium" />  
                                <f:selectItem itemLabel="large" itemValue="large" />  

                                <p:ajax event="change" 
                                        update=":scatterPlotsForm:ScatterPlotsPanel"
                                        process="@this" />

                            </p:selectOneRadio>

                            <h:outputText rendered="#{histogramController.scatterPlotList == null}"
                                          value="NO SCATTERPLOTS"
                                          style="font-size: 200%;" />              

                            <p:dataGrid columns="#{fn:length(histogramController.parametersPchem)}"
                                        rendered="#{histogramController.scatterPlotList != null}" 
                                        value="#{histogramController.scatterPlotList}" 
                                        var="scat" 
                                        rowIndexVar="scatPlotIdx">      

                                <p:chart type="line" 
                                         model="#{scat}" 
                                         style="display: inline-block; height: #{histogramController.scatterPlotSize}px; width: #{histogramController.scatterPlotSize}px" 
                                         widgetVar="widgetScatterPlotChart#{scatPlotIdx}">

                                    <p:ajax event="itemSelect" 
                                            immediate="true" 
                                            process="@this"
                                            listener="#{histogramController.itemSelectScatterPlot}"
                                            update=":histogramsForm:HistogramsPanel,:scatterPlotsForm:ScatterPlotsPanel,:structuresForm:StructuresPanel"/>   

                                </p:chart>

                            </p:dataGrid>

                        </p:outputPanel>

                    </h:form>

                </p:layoutUnit>

                <p:layoutUnit position="south" 
                              resizable="true" 
                              size="50%" 
                              minSize="100">	

                    <h:form id="structuresForm" enctype="multipart/form-data">

                        <p:outputPanel id="StructuresPanel">

                            <p:commandButton onclick="structuresAsGridImage();" 
                                             value="All structures as image grid" />

                            <br/>

                            <p:selectOneRadio value="#{histogramController.structureSizeString}" >

                                <f:selectItem itemLabel="small" itemValue="small" />  
                                <f:selectItem itemLabel="medium" itemValue="medium" />  
                                <f:selectItem itemLabel="large" itemValue="large" />  

                                <p:ajax event="change" 
                                        update=":structuresForm:StructuresPanel" 
                                        process="@this" />

                            </p:selectOneRadio>

                            <br/>

                            <h:outputText rendered="#{empty histogramController.selectedCmpdListMembers}"
                                          value="NO SELECTED COMPOUNDS"
                                          style="font-size: 200%;" />

                            <h:outputText rendered="#{!empty histogramController.selectedCmpdListMembers}"
                                          value="Selected List Members with #{fn:length(histogramController.selectedCmpdListMembers)} selected"
                                          style="font-size: 200%;" />

                            <br/>

                            <ui:repeat rendered="#{!empty histogramController.selectedCmpdListMembers}"
                                       value="#{histogramController.selectedCmpdListMembers}"
                                       var="clm">

                                <h:graphicImage rendered="#{!empty clm.cmpd}"
                                                alt="Chemical Structure of Parent Fragment"
                                                width="#{histogramController.structureSize}" 
                                                height="#{histogramController.structureSize}"
                                                styleClass="parentStructure"                                
                                                url='#{sessionController.configurationBean.getCmpdStrcUrl(clm.cmpd, listManagerController.listManagerBean.activeList.anchorSmiles)}'>              

                                    <p:ajax event="click" 
                                            immediate="true" 
                                            process="@this"
                                            listener="#{histogramController.itemSelectChemicalStructure(clm.cmpd.nsc)}"/>   

                                </h:graphicImage> 

                            </ui:repeat>

                        </p:outputPanel>

                    </h:form>

                </p:layoutUnit>

            </p:layout>

            <ui:include src="/webpages/dialogExportImage.xhtml"/>

        </h:body>

    </f:view>

</html>