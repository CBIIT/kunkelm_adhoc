<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:p="http://primefaces.org/ui">

  <f:view contentType="text/html">

    <h:head>
      <f:facet name="first">
        <meta http-equiv="X-UA-Compatible" content="EmulateIE8" />
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
        <title>Data System Project Histograms and ScatterPlots</title>
      </f:facet>

      <noscript>
        <font color="red" size="5">This website makes use of javascript.  Please enable javascript in your web browser and reload this web page.</font>
      </noscript>

      <h:outputScript library="js" name="dctdDataSystem.js"/>                
      <h:outputScript library="js" name="canvasWrangling.js"/>
      <h:outputStylesheet library="css" name="my.css"/>


    </h:head>

    <h:body>

      <p:growl id="msgs" 
               showDetail="true" 
               autoUpdate="true"
               sticky="true" />

      <p:layout  fullPage="true">

        <p:layoutUnit position="north" 
                      resizable="true" 
                      size="100" 
                      minSize="100">	

          <h:form id="histogramsConfigurationForm" enctype="multipart/form-data">

            <p:outputPanel id="HistogramsConfiguration">

              <h:outputText style="font-size: 200%;" value="List #{listManagerController.activeList.listName} with #{fn:length(listManagerController.activeList.cmpdListMembers)} Members"/>

              <p:selectManyCheckbox value="#{histogramController.parametersPchem}" >  
                <f:selectItem itemLabel="mw" itemValue="mw" />  
                <f:selectItem itemLabel="hba" itemValue="hba" />  
                <f:selectItem itemLabel="hbd" itemValue="hbd" />  
                <f:selectItem itemLabel="alogp" itemValue="alogp" />  
                <f:selectItem itemLabel="logd" itemValue="logd" />  
                <f:selectItem itemLabel="sa" itemValue="sa" />  
                <f:selectItem itemLabel="psa" itemValue="psa" />  
              </p:selectManyCheckbox>
              
              <p:spacer height="20" width="100%" />

              
              <p:commandButton ajax="true" 
                               disabled="#{empty listManagerController.activeList}"
                               value="HISTOGRAMS"
                               icon="ui-icon-image"
                               action="#{histogramController.renderHistoAndScatter()}"
                               update=":histogramsForm:HistogramsDialog,:scatterPlotsForm:ScatterPlotsDialog,:selectedListMembersForm:SelectedListMembersDialog" />   
              
            </p:outputPanel>

          </h:form>

        </p:layoutUnit>

        <p:layoutUnit position="west" 
                      resizable="true" 
                      size="50%" 
                      minSize="100">	

          <h:form id="histogramsForm" enctype="multipart/form-data">

            <p:outputPanel id="HistogramsDialog">

              <p:selectOneRadio value="#{histogramController.histogramSizeString}">
                <f:selectItem itemLabel="small" itemValue="small" />  
                <f:selectItem itemLabel="medium" itemValue="medium" />  
                <f:selectItem itemLabel="large" itemValue="large" />  

                <p:ajax event="change" 
                        update=":histogramsForm:HistogramsDialog"
                        process="@this" />

              </p:selectOneRadio>

              <h:outputText rendered="#{histogramController.histoModel == null}"
                            value="NO HISTOGRAMS"
                            style="font-size: 200%;" />

              <ui:repeat rendered="#{histogramController.histoModel != null}"
                         value="#{histogramController.histoModel}" 
                         var="histo">      

                <p:chart type="bar" 
                         model="#{histo.chartModel}" 
                         style="display: inline-block; height: #{histogramController.histogramSize}px; width: #{histogramController.histogramSize}px">

                  <p:ajax event="itemSelect" 
                          immediate="true" 
                          process="@this"
                          listener="#{histogramController.itemSelectHistogram}"
                          update=":histogramsForm:HistogramsDialog,:scatterPlotsForm:ScatterPlotsDialog,:selectedListMembersForm:SelectedListMembersDialog"/>   

                </p:chart>

              </ui:repeat>

            </p:outputPanel>

          </h:form>

        </p:layoutUnit>

        <p:layoutUnit position="center"
                      resizable="true">	

          <h:form id="scatterPlotsForm" enctype="multipart/form-data">

            <p:outputPanel id="ScatterPlotsDialog">

              <p:selectOneRadio value="#{histogramController.scatterPlotSizeString}">
                <f:selectItem itemLabel="small" itemValue="small" />  
                <f:selectItem itemLabel="medium" itemValue="medium" />  
                <f:selectItem itemLabel="large" itemValue="large" />  

                <p:ajax event="change" 
                        update=":scatterPlotsForm:ScatterPlotsDialog"
                        process="@this" />

              </p:selectOneRadio>

              <h:outputText rendered="#{histogramController.scatterPlotModel == null}"
                            value="NO SCATTERPLOTS"
                            style="font-size: 200%;" />              

              <p:dataGrid columns="#{fn:length(histogramController.parametersPchem)}"
                          rendered="#{histogramController.scatterPlotModel != null}" 
                          value="#{histogramController.scatterPlotModel}" 
                          var="scat">      

                <p:chart type="line" 
                         model="#{scat}" 
                         style="display: inline-block; height: #{histogramController.scatterPlotSize}px; width: #{histogramController.scatterPlotSize}px" >

                  <p:ajax event="itemSelect" 
                          immediate="true" 
                          process="@this"
                          listener="#{histogramController.itemSelectScatterPlot}"
                          update=":histogramsForm:HistogramsDialog,:scatterPlotsForm:ScatterPlotsDialog,:selectedListMembersForm:SelectedListMembersDialog"/>   

                </p:chart>

              </p:dataGrid>

            </p:outputPanel>

          </h:form>

        </p:layoutUnit>

        <p:layoutUnit position="south" 
                      resizable="true" 
                      size="50%" 
                      minSize="100">	

          <h:form id="selectedListMembersForm" enctype="multipart/form-data">

            <p:outputPanel id="SelectedListMembersDialog">

              <p:commandButton onclick="imageGridFromAllSelectedStructures();" value="All structures as image grid" />

              <br/>

              <p:selectOneRadio value="#{histogramController.structureSizeString}" >

                <f:selectItem itemLabel="small" itemValue="small" />  
                <f:selectItem itemLabel="medium" itemValue="medium" />  
                <f:selectItem itemLabel="large" itemValue="large" />  

                <p:ajax event="change" 
                        update=":selectedListMembersForm:SelectedListMembersDialog" 
                        process="@this" />

              </p:selectOneRadio>

              <br/>

              <h:outputText rendered="#{empty listManagerController.selectedActiveListMembers}"
                            value="NO SELECTED COMPOUNDS"
                            style="font-size: 200%;" />


              <h:outputText rendered="#{!empty listManagerController.selectedActiveListMembers}"
                            value="Selected List Members with #{fn:length(listManagerController.selectedActiveListMembers)} selected"
                            style="font-size: 200%;" />

              <br/>

              <ui:repeat rendered="#{!empty listManagerController.selectedActiveListMembers}"
                         value="#{listManagerController.selectedActiveListMembers}"
                         var="clm">

                <h:graphicImage rendered="#{!empty clm.cmpd.parentFragment.cmpdFragmentStructure.canSmi}"
                                alt="png-structure-image"
                                width="#{histogramController.structureSize}" 
                                height="#{histogramController.structureSize}"
                                id="selectedStructureImg"
                                class="selectedListMemberStructureImage"                          
                                url='/StructureServlet?color-atoms=true&amp;structureDim=200&amp;title=#{clm.cmpd.name}&amp;smiles=#{applicationScopeBean.urlEncode(clm.cmpd.parentFragment.cmpdFragmentStructure.canSmi)}&amp;querySmiles=#{applicationScopeBean.urlEncode(listManagerController.activeList.anchorSmiles)}'>
                </h:graphicImage> 

              </ui:repeat>

            </p:outputPanel>

          </h:form>

        </p:layoutUnit>

      </p:layout>

    </h:body>

  </f:view>

</html>