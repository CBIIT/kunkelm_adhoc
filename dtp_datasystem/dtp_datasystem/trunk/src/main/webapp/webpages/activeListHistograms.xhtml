<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:p="http://primefaces.org/ui">

  <f:view contentType="text/html">

    <h:head>
      <f:facet name="first">
        <meta http-equiv="X-UA-Compatible" content="EmulateIE8" />
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
        <title>Data System Project Histograms and ScatterPlots</title>
      </f:facet>

      <noscript>
        <font color="red" size="5">This website makes use of javascript.  Please enable javascript in your web browser and reload this web page.</font>
      </noscript>

      <h:outputScript library="js" name="dctdDataSystem.js"/>                
      <h:outputScript library="js" name="canvasWrangling.js"/>
      <h:outputStylesheet library="css" name="my.css"/>


    </h:head>

    <h:body>
      
      <p:growl id="msgs" showDetail="true" autoUpdate="true"/>

      <p:layout  fullPage="true">

        <p:layoutUnit position="north" 
                      resizable="true" 
                      size="100" 
                      minSize="100">	


          <h:form id="histogramsConfigurationForm" enctype="multipart/form-data">

            <p:outputPanel id="HistogramsConfiguration">

              <h:outputText style="font-size: 200%;" value="List #{listManagerController.activeList.listName} with #{fn:length(listManagerController.activeList.cmpdListMembers)} Members"/>

              <p:commandButton ajax="true" 
                               disabled="#{empty listManagerController.activeList}"
                               value="HISTOGRAMS"
                               icon="ui-icon-image"
                               action="#{histogramController.renderHistoAndScatter()}"
                               update=":histogramsForm:HistogramsDialog,:scatterPlotsForm:ScatterPlotsDialog,:selectedListMembersForm:SelectedListMembersDialog" />   

              <p:selectManyCheckbox value="#{histogramController.parametersPchem}" >  
                <f:selectItem itemLabel="mw" itemValue="mw" />  
                <f:selectItem itemLabel="hba" itemValue="hba" />  
                <f:selectItem itemLabel="hbd" itemValue="hbd" />  
                <f:selectItem itemLabel="alogp" itemValue="alogp" />  
                <f:selectItem itemLabel="logd" itemValue="logd" />  
                <f:selectItem itemLabel="sa" itemValue="sa" />  
                <f:selectItem itemLabel="psa" itemValue="psa" />  
              </p:selectManyCheckbox>

            </p:outputPanel>

          </h:form>

        </p:layoutUnit>

        <p:layoutUnit position="west" 
                      resizable="true" 
                      size="50%" 
                      minSize="100">	

          <h:form id="histogramsForm" enctype="multipart/form-data">

            <p:outputPanel id="HistogramsDialog">

              <p:remoteCommand name="remoteDoUpdateHistograms"
                               action="#{histogramController.placeholderAction()}"
                               update=":histogramsForm:HistogramsDialog" />   

              <p:selectOneRadio value="#{histogramController.histogramSizeString}"
                                onchange="remoteDoUpdateHistograms()">
                <f:selectItem itemLabel="small" itemValue="small" />  
                <f:selectItem itemLabel="medium" itemValue="medium" />  
                <f:selectItem itemLabel="large" itemValue="large" />  
              </p:selectOneRadio>

              <h:outputText rendered="#{histogramController.histoModel == null}"
                            value="NO HISTOGRAMS"
                            style="font-size: 200%;" />

              <ui:repeat rendered="#{histogramController.histoModel != null}"
                         value="#{histogramController.histoModel}" 
                         var="histo">      

                <p:barChart value="#{histo.chartModel}"
                            title="#{histo.chartModel.title}"                      
                            extender="histogramExtender"
                            zoom="false"
                            showDatatip="true"
                            style="display: inline-block; height: #{histogramController.histogramSize}px; width: #{histogramController.histogramSize}px"
                            barPadding="1"
                            barMargin="1"
                            xaxisAngle="-90"
                            animate="true"
                            stacked="true">

                  <p:ajax event="itemSelect" 
                          immediate="true" 
                          process="@this"
                          listener="#{histogramController.itemSelectHistogram}"
                          update=":histogramsForm:HistogramsDialog,:scatterPlotsForm:ScatterPlotsDialog,:selectedListMembersForm:SelectedListMembersDialog"/>   

                </p:barChart>

              </ui:repeat>

            </p:outputPanel>

          </h:form>

        </p:layoutUnit>

        <p:layoutUnit position="center"
                      resizable="true">	

          <h:form id="scatterPlotsForm" enctype="multipart/form-data">

            <p:outputPanel id="ScatterPlotsDialog">

              <p:remoteCommand name="remoteDoUpdateScatterPlots"
                               action="#{histogramController.placeholderAction()}"
                               update=":scatterPlotsForm:ScatterPlotsDialog" />   

              <p:selectOneRadio value="#{histogramController.scatterPlotSizeString}"
                                onchange="remoteDoUpdateScatterPlots()">
                <f:selectItem itemLabel="small" itemValue="small" />  
                <f:selectItem itemLabel="medium" itemValue="medium" />  
                <f:selectItem itemLabel="large" itemValue="large" />  
              </p:selectOneRadio>

              <h:outputText rendered="#{histogramController.scatterPlotModel == null}"
                            value="NO SCATTERPLOTS"
                            style="font-size: 200%;" />              

              <ui:repeat rendered="#{histogramController.scatterPlotModel != null}" 
                         value="#{histogramController.scatterPlotModel}" 
                         var="scat">      

                
                
                <p:lineChart value="#{scat}" 
                             title="#{scat.title}"
                             xaxisLabel="#{scat.labelAxisX}"
                             yaxisLabel="#{scat.labelAxisY}"
                             xaxisAngle="-90"            
                             zoom="true"
                             style="display: inline-block; height: #{histogramController.scatterPlotSize}px; width: #{histogramController.scatterPlotSize}px"
                             extender="scatterPlotExtender">
                  
                  <p:ajax event="itemSelect" 
                          immediate="true" 
                          process="@this"
                          listener="#{histogramController.itemSelectScatterPlot}"
                          update=":histogramsForm:HistogramsDialog,:scatterPlotsForm:ScatterPlotsDialog,:selectedListMembersForm:SelectedListMembersDialog"/>   

                </p:lineChart>

              </ui:repeat>

            </p:outputPanel>

          </h:form>

        </p:layoutUnit>

        <p:layoutUnit position="south" 
                      resizable="true" 
                      size="50%" 
                      minSize="100">	

          <h:form id="selectedListMembersForm" enctype="multipart/form-data">

            <p:outputPanel id="SelectedListMembersDialog">

              <p:remoteCommand name="remoteDoUpdateSelectedListMembers"
                               action="#{histogramController.placeholderAction()}"
                               update=":selectedListMembersForm:SelectedListMembersDialog" />

              <p:commandButton onclick="imageGridFromAllSelectedStructures();" value="All structures as image grid" />

              <br/>

              <p:selectOneRadio value="#{histogramController.structureSizeString}"
                                onchange="remoteDoUpdateSelectedListMembers()" >
                <f:selectItem itemLabel="small" itemValue="small" />  
                <f:selectItem itemLabel="medium" itemValue="medium" />  
                <f:selectItem itemLabel="large" itemValue="large" />  
              </p:selectOneRadio>

              <br/>

              <h:outputText rendered="#{empty listManagerController.selectedActiveListMembers}"
                            value="NO SELECTED COMPOUNDS"
                            style="font-size: 200%;" />


              <h:outputText rendered="#{!empty listManagerController.selectedActiveListMembers}"
                            value="Selected List Members with #{fn:length(listManagerController.selectedActiveListMembers)} selected"
                            style="font-size: 200%;" />

              <br/>

              <ui:repeat rendered="#{!empty listManagerController.selectedActiveListMembers}"
                         value="#{listManagerController.selectedActiveListMembers}"
                         var="clm">

                <h:graphicImage rendered="#{!empty clm.cmpd.parentFragment.cmpdFragmentStructure.canSmi}"
                                alt="png-structure-image"
                                width="#{histogramController.structureSize}" 
                                height="#{histogramController.structureSize}"
                                id="selectedStructureImg"
                                class="selectedListMemberStructureImage"                          
                                url='/StructureServlet?structureDim=200&amp;title=#{clm.cmpd.name}&amp;smiles=#{applicationScopeBean.urlEncode(clm.cmpd.parentFragment.cmpdFragmentStructure.canSmi)}&amp;querySmiles=#{applicationScopeBean.urlEncode(listManagerController.activeList.anchorSmiles)}'>
                </h:graphicImage> 

              </ui:repeat>

            </p:outputPanel>

          </h:form>

        </p:layoutUnit>

      </p:layout>

    </h:body>

  </f:view>

</html>