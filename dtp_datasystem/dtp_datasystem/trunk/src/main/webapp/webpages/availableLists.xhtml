<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"      
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                template="/webpages/templates/ui.xhtml">

  <ui:define name="content title">
    <h:outputText value="Available Lists" />
  </ui:define>

  <ui:define name="instructions"/>

  <ui:define name="export"> 
    <h2 style="margin: 0;">
      <h:outputText value="Export Data or Images"/>
    </h2>
    <p:menubar>
      <p:menuitem ajax="false" value="Export to Excel">
        <p:dataExporter type="xls"  
                        target="availableListsTbl" 
                        fileName="availableListsTable" />  
      </p:menuitem>
      <p:menuitem ajax="false" value="Export as CSV">  
        <p:dataExporter type="csv" 
                        target="availableListsTbl" 
                        fileName="availableListsTable" />  
      </p:menuitem> 
    </p:menubar>
  </ui:define>

  <ui:define name="alternate">
  </ui:define>

  <ui:define name="content">
    
    <p:commandButton value="Update Lists"
                     action="#{listManagerController.performUpdateAvailableLists()}"/>

    <p:spacer height="20" width="100%"/>

    <p:dataTable id="availableListsTbl"
                 tableStyle="width: auto;"
                 resizableColumns="true"
                 editable="true"                      
                 var="list"
                 value="#{listManagerController.listManagerBean.availableLists}"
                 paginator="true" 
                 rows="10"  
                 filteredValue="#{listManagerController.listManagerBean.filteredAvailableLists}"
                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                 rowsPerPageTemplate="10,25,50">

      <f:facet name="header">  
        #{fn:length(listManagerController.listManagerBean.availableLists)} Available Lists
      </f:facet>

      <p:ajax event="rowEdit" listener="#{listManagerController.onRowEdit}" update=":datasystemForm:msgs" />
      <p:ajax event="rowEditCancel" listener="#{listManagerController.onRowCancel}" update=":datasystemForm:msgs" />
      <p:ajax event="cellEdit" listener="#{listManagerController.onCellEdit}" update=":datasystemForm:msgs" />

      <p:column style="width:32px"
                exportable="false">
        <p:rowEditor rendered="#{list.listOwner == sessionController.loggedUser}"/>
      </p:column>

      <p:column exportable="false">

        <p:commandLink value="VIEW"                                             
                       action="#{listManagerController.performLoadSelectedList()}"
                       onstart="PF('loadingBUI').show();"
                       oncomplete="PF('loadingBUI').hide();">      
          <f:setPropertyActionListener value="#{list}"   
                                       target="#{listManagerController.listManagerBean.activeList}"/>  
        </p:commandLink>

        <h:outputText escape="false" value="&lt;br/&gt;"/>

        <!--
        
        <p:commandLink disabled="#{list.listOwner != sessionController.loggedUser || list.shareWith == 'EVERYONE'}"
                       value="SHARE" style="color: green;"
                       action="#{listManagerController.performMakeListPublic()}">      
          <f:setPropertyActionListener value="#{list}"   
                                       target="#{listManagerController.listManagerBean.activeList}"/>
        </p:commandLink>

        <h:outputText escape="false" value="&lt;br/&gt;"/>

        -->
        
        <p:commandLink disabled="#{list.listOwner != sessionController.loggedUser || list.shareWith == 'EVERYONE'}"                
                       value="DELETE" style="color: red;"
                       action="#{listManagerController.performInitiateDeleteList}">

          <f:param name="cmpdListIdForDelete" value="#{list.cmpdListId}"/>

        </p:commandLink>

      </p:column>

      <p:column resizable="true" sortBy="#{list.dateCreated}">
        <f:facet name="header">
          Date Created <br/> CmpdListId
        </f:facet>
        <h:outputText value="#{list.dateCreated}" /> 
        <br/>
        <h:outputText value="#{list.cmpdListId}" />  
      </p:column> 

      <p:column headerText="ListName"  
                width="40%"
                resizable="true" 
                sortBy="#{list.listName}"
                filterBy="#{list.listName}"
                filterMatchMode="contains">       
        <p:cellEditor>
          <f:facet name="output"><h:outputText value="#{list.listName}" /></f:facet>
          <f:facet name="input"><p:inputText id="listNameInput" value="#{list.listName}" style="width:100%"/></f:facet>
        </p:cellEditor>
      </p:column> 

      <p:column  headerText="List Size" resizable="true" sortBy="#{list.countListMembers}">              
        <h:outputText value="#{list.countListMembers}" />  
      </p:column> 

      <p:column headerText="Owner" resizable="true" sortBy="#{list.listOwner}"
                filterBy="#{list.listOwner}"
                filterMatchMode="contains">
        <h:outputText value="#{list.listOwner}" />  
      </p:column> 

      <!--
      
      <p:column headerText="Share With" resizable="true" sortBy="#{list.shareWith}">              
        <h:outputText value="#{list.shareWith}" />  
      </p:column> 
      
      -->

      <p:column headerText="List Comment" resizable="true"
                filterBy="#{list.listComment}"
                filterMatchMode="contains">
        <p:cellEditor>
          <f:facet name="output"><h:outputText value="#{list.listComment}" /></f:facet>
          <f:facet name="input"><p:inputText id="listCommentInput" value="#{list.listComment}" style="width:100%"/></f:facet>
        </p:cellEditor>
      </p:column> 

      <p:column headerText="Anchor Comment" resizable="true"
                filterBy="#{list.anchorComment}"
                filterMatchMode="contains">             
        <p:cellEditor>
          <f:facet name="output"><h:outputText value="#{list.anchorComment}" /></f:facet>
          <f:facet name="input"><p:inputText id="anchorCommentInput" value="#{list.anchorComment}" style="width:100%"/></f:facet>
        </p:cellEditor>
      </p:column> 

      <p:column headerText="Anchor SMILES" resizable="true">   
        <p:cellEditor>
          <f:facet name="output"><h:outputText value="#{list.anchorSmiles}" /></f:facet>
          <f:facet name="input"><p:inputText id="anchorSmilesInput" value="#{list.anchorSmiles}" style="width:100%"/></f:facet>
        </p:cellEditor>
      </p:column> 

    </p:dataTable>

  </ui:define>

</ui:composition>