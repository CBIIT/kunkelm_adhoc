<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"      
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                template="/webpages/templates/ui.xhtml">

  <ui:define name="content title">
    <h:outputText value="Active List Form View #{listManagerController.listManagerBean.activeList.listName} with #{fn:length(listManagerController.listManagerBean.activeList.cmpdListMembers)} ListMembers" />  
  </ui:define>

  <ui:define name="instructions">
    <h:outputText value="Soring and filtering of the list can be
                  done in the Table View.  Changes made there will 
                  be reflected in this view."/>
  </ui:define>        

  <ui:define name="export">    
  </ui:define>        

  <ui:define name="alternate">    
  </ui:define>        

  <ui:define name="content">

    <p:panel header="List Anchor Structure"
             rendered="#{sessionController.configurationBean.showAnchor and !empty listManagerController.listManagerBean.activeList.anchorSmiles}">

      <h:outputText value="anchorSmiles: ${listManagerController.listManagerBean.activeList.anchorSmiles}"/>

      <br/>

      <p:graphicImage alt="Chemical Structure of List Anchor"
                      width="#{sessionController.configurationBean.strcDim}" 
                      height="#{sessionController.configurationBean.strcDim}"
                      styleClass="anchorStructure"
                      url='#{sessionController.configurationBean.getSmilesStrcUrl(listManagerController.listManagerBean.activeList.anchorSmiles)}'>              
      </p:graphicImage>

    </p:panel>

    <p:dataGrid id="theDataGrid"
                var="listMember" 
                value="#{listManagerController.listManagerBean.filteredActiveListMembers}"                                     
                columns="1"  
                rows="1" 
                paginator="true"  
                currentPageReportTemplate="Page: {currentPage}/{totalPages} Records: {startRecord}-{endRecord} out of {totalRecords} filtered records"                
                paginatorTemplate="{CurrentPageReport}  {PreviousPageLink} {PageLinks} {NextPageLink}">  

      <f:facet name="header">  
        <p:row>  
          <p:column>List Contains: #{fn:length(listManagerController.listManagerBean.activeList.cmpdListMembers)} Cmpds</p:column>  
        </p:row>                                              
      </f:facet>

      <h1>

        <ui:fragment rendered="#{!empty(listMember.cmpd.nsc)}">
          <h:outputText value="NSC: "/>            
          <h:outputText value="#{listMember.cmpd.nsc}"/>

          <h:outputText value=" nscCmpdType: "/>            
          <h:outputText value="#{listMember.cmpd.nscCmpdType}"/>

          <h:outputText value=" nscCmpdId: "/>
          <h:outputText value="#{listMember.cmpd.nscCmpdId}"/>
        </ui:fragment>

        <ui:fragment rendered="#{!empty(listMember.cmpd.adHocCmpdId)}">
          <h:outputText value="adHocCmpdId: "/>            
          <h:outputText value="#{listMember.cmpd.adHocCmpdId}"/>
          <h:outputText value=" originalAdHocCmpdId: "/>            
          <h:outputText value="#{listMember.cmpd.originalAdHocCmpdId}"/>
        </ui:fragment>

      </h1>        

      <p:panelGrid>

        <p:panel style="display: inline-block;"
                 rendered="#{!(empty listMember.cmpd.nsc)}">
          <f:facet name="header">
            <h:outputText value="Kekule Image of Legacy Compound" />
          </f:facet>
          <p:graphicImage alt="Kekule Image of Legacy Compound"
                          width="#{sessionController.configurationBean.strcDim}" height="#{sessionController.configurationBean.strcDim}"                                
                          styleClass="unassignedClass"                                                                                        
                          url='/LegacyImageServlet?nsc=#{listMember.cmpd.nsc}'>                                          
          </p:graphicImage>
        </p:panel>

        <p:panel style="display: inline-block;">
          <f:facet name="header">
            <h:outputText value="Parent Fragment Structure" />
          </f:facet>
          <p:graphicImage rendered="#{!empty listMember.cmpd}"
                          alt="Chemical Structure of Parent Fragment"
                          styleClass="unassignedClass"
                          width="#{sessionController.configurationBean.strcDim}" 
                          height="#{sessionController.configurationBean.strcDim}"                                
                          url='#{sessionController.configurationBean.getCmpdStrcUrl(listMember.cmpd, listManagerController.listManagerBean.activeList.anchorSmiles)}'>              
          </p:graphicImage>
        </p:panel>

        <p:panel rendered="#{sessionController.configurationBean.showFrags}"
                 style="display: inline-block">
          <f:facet name="header">
            <h:outputText value="All Fragments" />
          </f:facet>
          <ui:repeat value="#{listMember.cmpd.cmpdFragmentSmilesStrings}" 
                     var="fragSmiles">
            <p:graphicImage alt="Chemical Structure of Compound Fragment"
                            styleClass="fragmentStructure"
                            width="#{sessionController.configurationBean.strcDim}" height="#{sessionController.configurationBean.strcDim}"                                        
                            url='#{sessionController.configurationBean.getSmilesStrcUrl(fragSmiles)}'>              
            </p:graphicImage>

          </ui:repeat>
        </p:panel>

        <p:panel rendered="#{sessionController.configurationBean.showQc}"
                 style="display: inline-block;">
          <f:facet name="header">
            <h:outputText value="MTXT" />
          </f:facet>
          <h:inputTextarea readonly="true" 
                           value="#{listMember.cmpd.cmpdAnnotation.mtxt}"
                           cols="50" 
                           rows="5"/>
        </p:panel>

        <p:panel rendered="#{sessionController.configurationBean.showQc}"
                 style="display: inline-block;">
          <f:facet name="header">
            <h:outputText value="pseudoAtoms" />
          </f:facet>
          <h:inputTextarea readonly="true" 
                           value="#{listMember.cmpd.cmpdAnnotation.pseudoAtoms}"
                           cols="50" 
                           rows="5"/>
        </p:panel>  

      </p:panelGrid>

      <p:panelGrid columns="3" style="width: auto;"> 
        <h:outputText value="PROD"/>            
        <h:outputText value="#{listMember.cmpd.prodMolecularFormula}"/>            
        <h:outputText value="#{listMember.cmpd.prodFormulaWeight}">            
          <f:convertNumber pattern="#0.00" />
        </h:outputText>

        <h:outputText value="CMPD"/>
        <h:outputText value="#{listMember.cmpd.formulaMolecularFormula}"/>
        <h:outputText value="#{listMember.cmpd.formulaWeight}">            
          <f:convertNumber pattern="#0.00" />
        </h:outputText>

        <h:outputText value="PARENT"/>            
        <h:outputText value="#{listMember.cmpd.parentMolecularFormula}"/>            
        <h:outputText value="#{listMember.cmpd.parentMolecularWeight}">            
          <f:convertNumber pattern="#0.00" />
        </h:outputText>
      </p:panelGrid>

      <p:panelGrid>

        <f:facet name="header">  
          <p:row>  
            <p:column colspan="6">#{listMember.cmpd.name} #{listMember.cmpd.nscCmpdType}</p:column>  
          </p:row>  
        </f:facet>  

        <p:row>  
          <p:column style="white-space: nowrap" 
                    colspan="6" 
                    styleClass="ui-widget-header">
            <h:outputText value="NSC Compound"/>
          </p:column>                  
        </p:row>

        <p:row>
          <p:column style="font-weight:bold">Conf</p:column>
          <p:column>#{listMember.cmpd.conf}</p:column>

          <p:column style="font-weight:bold">Distribution</p:column>
          <p:column>#{listMember.cmpd.distribution}</p:column>

          <p:column style="font-weight:bold">Inventory</p:column>
          <p:column>#{listMember.cmpd.inventory}</p:column>
        </p:row>

        <p:row>  
          <p:column style="white-space: nowrap" 
                    colspan="6" 
                    styleClass="ui-widget-header">
            Biological Data (Count Experiments)
          </p:column>                  
        </p:row>

        <p:row>
          <p:column style="font-weight:bold">NCI60</p:column>
          <p:column>#{listMember.cmpd.cmpdBioAssay.nci60}</p:column>

          <p:column style="font-weight:bold">XENO</p:column>
          <p:column>#{listMember.cmpd.cmpdBioAssay.xeno}</p:column>

          <p:column style="font-weight:bold">HF</p:column>
          <p:column>#{listMember.cmpd.cmpdBioAssay.hf}</p:column>
        </p:row>

        <p:row>
          <p:column style="white-space: nowrap" 
                    colspan="6" 
                    styleClass="ui-widget-header">
            Identifiers
          </p:column>  
        </p:row>

        <p:row>
          <p:column style="font-weight:bold">NSC</p:column>
          <p:column>#{listMember.cmpd.nsc}</p:column>

          <p:column style="font-weight:bold">CAS</p:column>
          <p:column>#{listMember.cmpd.cas}</p:column>

          <p:column style="font-weight:bold">Agent</p:column>
          <p:column/>
        </p:row>


        <p:row>  
          <p:column style="white-space: nowrap" 
                    colspan="2" 
                    styleClass="ui-widget-header">
            Plates
          </p:column>  
          <p:column style="white-space: nowrap" 
                    colspan="2" 
                    styleClass="ui-widget-header">
            Projects
          </p:column>                      
          <p:column style="white-space: nowrap" 
                    colspan="2" 
                    styleClass="ui-widget-header">
            Aliases
          </p:column>  
        </p:row>

        <p:row>

          <p:column colspan="2">
            <p:dataList value="#{listMember.cmpd.plates}" var="n" itemType="disc">
              #{n}
            </p:dataList>
          </p:column>

          <p:column colspan="2">
            <p:dataList value="#{listMember.cmpd.projects}" var="n" itemType="disc">
              #{n}
            </p:dataList>
          </p:column>

          <p:column colspan="2">
            <p:dataList var="prop" 
                        value="#{listMember.cmpd.aliases}"
                        rows="5" 
                        paginator="true"
                        paginatorPosition="top" 
                        paginatorAlwaysVisible="false"
                        currentPageReportTemplate="Page: {currentPage}/{totalPages} Records: {startRecord}-{endRecord} out of {totalRecords}"
                        paginatorTemplate="{CurrentPageReport} {PreviousPageLink} {NextPageLink}">
              <!--<h:outputText value="#{prop.length() gt 50 ? prop.substring(0,49).concat('...') : prop}" />-->
              <h:outputText style="white-space: pre-line" value="#{prop}" />
            </p:dataList>
          </p:column>

        </p:row>

        <p:row>
          <p:column style="white-space: nowrap" colspan="6" styleClass="ui-widget-header">Canonical SMILES</p:column>  
        </p:row>

        <p:row>
          <p:column colspan="6">                
            <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentStructure.canSmi}"/>
          </p:column>
        </p:row>

        <p:row>
          <p:column style="white-space: nowrap" colspan="6" styleClass="ui-widget-header">Canonical Tautomer SMILES</p:column>  
        </p:row>

        <p:row>
          <p:column colspan="6">                
            <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentStructure.canTaut}"/>
          </p:column>
        </p:row>

        <p:row>
          <p:column style="white-space: nowrap" colspan="6" styleClass="ui-widget-header">Canonical Tautomer Strip Stereo SMILES</p:column>  
        </p:row>

        <p:row>
          <p:column colspan="6">                
            <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentStructure.canTautStripStereo}"/>
          </p:column>
        </p:row>

        <p:row>
          <p:column style="white-space: nowrap" colspan="6" styleClass="ui-widget-header">Parent InChI</p:column>  
        </p:row>

        <p:row>
          <p:column colspan="6">                
            <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentStructure.inchi}"/>
          </p:column>
        </p:row>

        <p:row>
          <p:column style="white-space: nowrap" colspan="6" styleClass="ui-widget-header">pChem dataGrid</p:column>  
        </p:row>

        <p:row>
          <p:column colspan="6">
            <p:dataGrid columns="6" 
                        value="#{sessionController.configurationBean.valid_physchem_keys.keySet()}" 
                        var="k">
              <p:panel header="#{k}">
                <h:outputText value="#{listMember.cmpd.parentFragment.cmpdFragmentPChem[sessionController.configurationBean.valid_physchem_keys.get(k)]}"
                              style="font: bold;"/>
              </p:panel>        
            </p:dataGrid>
          </p:column>
        </p:row>

      </p:panelGrid>

    </p:dataGrid>

  </ui:define>

</ui:composition>
